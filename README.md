# neighborhoodharmonizer


Uses Raspberry Pi 3B+ as the IoT hardware to control the relay of a neighborhoodharmonizer(i am 100% SURE that this is just a 12V LED and DO NOT contains any moving parts).  
Uses Arduino Uno R3 as the driver board.  
The GPIO features uses a lua library called lua periphery[https://github.com/vsergeev/lua-periphery] check the doc for more info.  
This project is port from a auto control project that coded by myself years ago, so you will see some useless or nonsense codes because this one is a ported.  
I won't make the code of this project beautiful or do any high-level optimization, because this is for use not for some skill-showing purpose.  

##update  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I just found that the original driver board with a STC chip on board and its program cannot support the idea that just use Raspberry Pi to control the relay and then, to control the overall power delivery, because all the `modes` supported by the stock driver will inevitably turn the device off after a period of time, up to 24h, and there is no way to let it turn itself on automatically again, since it is controlled by the remote control, and I am really want to avoid digging into the circuit board of that control pad, so i have to use a oscilloscope to figure out the signal it used to drive the device.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;After doing that i found it just uses a low-freq PWM with max voltage of 12V, and when you switch the mode, it just adjust the properties of a square wave, and lower or upper the voltage by its PWM during the HIGH state of the square wave. So I decided to use a Arduino to rewrite that driver, because that it do not have the ability to drive a 12V PWM, so I have to use the relay to control the signal, and since there is no need for me to use any mode that weaker than the strongest one, so I just need to regularize a square wave that has the same HIGH and LOW period, with same freq, and has a 12V HIGH period. That is pretty simple to implement on a Arduino, whether on the software or the hardware, and by outputing the right signal to drive the relay, I can get a 12V square wave that even better than the stock one cause there isn't any spikes and glitches on the square wave that generated by the PWM.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Because that I used the Arduino as the driver board, the Raspberry Pi will be no longer need to drive the relay and the only act of it is just to control the overall ON/OFF state. The IOs on the Pi board uses 3.3V as the HIGH voltage, but on Arduino, only 5V are recognized as a valid digital HIGH. So I have to passed the signal by the Pi to the analog port on Arduino and read the voltage converted by the internal DAC of it, and of course, enable the driving signal of the relay when it gets a proper voltage value.  
  
  
  
TODO List:  
add a remote controlling function, to turn the LED on instantly at anytime you want.  
my idea is to use a file to determine whether or not the user want to turn on the device instantly, and for the users, execute some simple command via SSH to do this by creating a file with a unique name for the main program to detect, and delete it as turning off.  
maybe there is some better solution in hardware level, like add a and-door to the circuit and control the relay simultaneously.  
